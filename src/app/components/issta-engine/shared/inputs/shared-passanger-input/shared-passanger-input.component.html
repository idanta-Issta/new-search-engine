<div class="passenger-input" #anchorEl>
  <app-input-box
    [icon]="config.icon ?? 'icon-user'"
    [title]="config.title"
    [placeholder]="config.placeholder ?? 'בחר נוסעים'"
    [isOpen]="isOpen"
    [model]="totalPassengers + ' נוסעים'"
    [width]="width"
    (click)="toggleDropdown()"
  ></app-input-box>

  <app-shared-dropdown
    [isOpen]="isOpen"
    (closed)="isOpen = false"
    [anchor]="anchorEl"
    [scrollable]="false"
    [position]="position"
    [marginRight]="getDropdownMarginRight()"
  >
    <div class="dropdown passenger-dropdown">
      <h4 class="title" *ngIf="config.titleMenuOptions">{{ config.titleMenuOptions }}</h4>

      <!-- Room-based selection (domestic vacation) - show all rooms simultaneously -->
      <ng-container *ngIf="value?.allowPickRoom && value?.rooms?.length">
        <div class="rooms-container">
          <div class="room-block" *ngFor="let room of value?.rooms; let i = index">
            <div class="room-header">
              <span class="room-title">חדר {{ room.roomNumber }}</span>
              <button type="button" class="remove-room" *ngIf="i > 0" (mousedown)="$event.stopPropagation()" (click)="removeRoom(i); $event.stopPropagation()">הסרה x</button>
            </div>
            <div class="passenger-types" *ngFor="let group of value?.optionsAge">
              <div class="passenger-row" *ngFor="let age of group.options">
                <div class="buttons">
                  <button
                    (click)="decrementRoom(i, age.value === 'adult' ? 'adults' : age.value === 'child' ? 'children' : 'infants')"
                    [disabled]="(age.value === 'adult' ? room.adults : age.value === 'child' ? room.children : room.infants) <= age.minCount"
                  >−</button>
                  <span class="count">{{ age.value === 'adult' ? room.adults : age.value === 'child' ? room.children : room.infants }}</span>
                  <button
                    (click)="incrementRoom(i, age.value === 'adult' ? 'adults' : age.value === 'child' ? 'children' : 'infants')"
                    [disabled]="!canIncrementRoom(i, age.value === 'adult' ? 'adults' : age.value === 'child' ? 'children' : 'infants')"
                  >+</button>
                </div>
                <div class="label">
                  {{ age.label }}
                  <small class="note">{{ age.note }}</small>
                </div>
              </div>
            </div>
          </div>
     
        </div>
      </ng-container>

    
      <div *ngIf="!value?.allowPickRoom" class="age-group-container">

        <div *ngIf="temporaryError" class="validation-error-banner">
          ⚠️ {{ temporaryError }}
        </div>
        <div *ngFor="let group of value?.optionsAge" class="age-group">
          <div *ngFor="let age of group.options" class="age-item">
            <div class="age-row">
              <div class="buttons">
                <button 
                  (click)="decrement(age)" 
                  [class.disabled-btn]="(age.count || 0) <= age.minCount">−</button>
                <span class="count">{{ age.count || 0 }}</span>
                <button 
                  (click)="increment(age)" 
                  [class.disabled-btn]="!canIncrement(age)">+</button>
              </div>
              <div class="label">
                {{ age.label }}
                <small class="note">{{ age.note }}</small>
              </div>
            </div>

            <div *ngIf="age.requiresSpecificAge && (age.count || 0) > 0" class="specific-ages">
              <label class="ages-label">גילאים</label>
              <div class="age-selectors-row">
                <div *ngFor="let i of getAgeArray(age.count || 0); let idx = index" class="age-selector">
                  <div class="custom-select" [class.open]="activeDropdown === age.value + '-' + idx" (click)="toggleAgeDropdown(age.value + '-' + idx)">
                    <div class="selected-value">
                      {{ age.selectedAges?.[idx] || (age.specificAgeOptions?.[0]?.label || 'בחר גיל') }}
                    </div>
                    <div class="dropdown-arrow">
                      <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1 1L6 6L11 1" stroke="#2AAE54" stroke-width="2" stroke-linecap="round"/>
                      </svg>
                    </div>
                    <div class="options-list" *ngIf="activeDropdown === age.value + '-' + idx">
                      <div 
                        *ngFor="let ageOption of age.specificAgeOptions" 
                        class="option-item"
                        [class.selected]="age.selectedAges?.[idx] === +ageOption.key"
                        (click)="selectAge(age, idx, +ageOption.key); $event.stopPropagation()">
                        {{ ageOption.label }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer section -->
      <div class="footer-section">
        <!-- Validation Errors Banner -->
        <div class="validation-errors" *ngIf="validationErrors.length > 0">
          <div class="error-item" *ngFor="let error of validationErrors">
            ⚠️ {{ error }}
          </div>
        </div>

        <div class="add-room-wrapper">
  
  <!-- כפתור רגיל אם אפשר להוסיף חדר -->
  <button *ngIf="canAddRoom()"
          class="add-room-btn"
          (mousedown)="$event.stopPropagation()"
          (click)="addRoom(); $event.stopPropagation()">
    + הוספת חדר
  </button> 

<div>
  <div class="extra-room-contact-label"
       *ngIf="!canAddRoom()">
   רוצה יותר מחדר אחד?
  </div>
  <div class="extra-room-contact"
       *ngIf="!canAddRoom()"
       (click)="showExtraRoomModal()">
 השאירו פרטים וסוכן יחזור אלייך
  </div>

</div>




</div>


<button class="confirm" (click)="isOpen = false">בחירה</button>
</div>
</div>
</app-shared-dropdown>
</div>

